<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Upload File</title>
<style>
body { font-family: Arial; background: #f5f5f5; text-align:center; padding:50px; }
.card { background:#fff; padding:30px; border-radius:20px; display:inline-block; box-shadow:0 5px 15px rgba(0,0,0,0.2); }
input, button { margin:10px; padding:12px 20px; font-size:16px; }
button { cursor:pointer; border:none; border-radius:10px; transition:.3s; }
button:hover { opacity:.8; }
#status { margin-top:20px; color:#333; }
</style>
</head>
<body>
<div class="card">
<h2>Upload File</h2>
<input type="file" id="fileInput"><br>
<button onclick="upload('button')">Upload + Button Page</button>
<button onclick="upload('direct')">Upload + Direct Page</button>
<div id="status"></div>
</div>

<script>
const BOT_TOKEN = '8552707260:AAFzSMfDkJbX_egvxFK7uoS6fmaepH90CSM'
const CHAT_ID = '1905862979'

async function upload(type){
    const file = document.getElementById('fileInput').files[0]
    if(!file) return alert('Select a file')
    const status = document.getElementById('status')
    status.innerText='Uploading...'

    try {
        const { fileUrl, name } = await uploadFile(file)
        let htmlContent = ''
        if(type==='button'){
            htmlContent = generateButtonPage(name, fileUrl)
        } else {
            htmlContent = generateDirectPage(name, fileUrl)
        }

        const blob = new Blob([htmlContent], {type:'text/html'})
        const url = URL.createObjectURL(blob)
        const link = document.createElement('a')
        link.href = url
        link.download = `${name}-${type}.html`
        link.innerText = `Download ${type} page`
        status.innerHTML=''
        status.appendChild(link)

    } catch(e){
        alert('Error: '+e.message)
        status.innerText=''
    }
}

async function uploadFile(file){
    const form = new FormData()
    form.append('chat_id', CHAT_ID)
    form.append('document', file)
    const res = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendDocument`, {
        method:'POST',
        body: form
    }).then(r=>r.json())
    if(!res.ok) throw new Error(res.description)
    const fileId = res.result.document.file_id
    const info = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/getFile?file_id=${fileId}`)
        .then(r=>r.json())
    const filePath = info.result.file_path
    const fileUrl = `https://api.telegram.org/file/bot${BOT_TOKEN}/${filePath}`
    return { fileUrl, name: file.name }
}

// توليد صفحة الزر
function generateButtonPage(name, fileUrl){
    return `
<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${name}</title>
<style>
body { text-align:center; padding:50px; font-family:Arial; background:#f5f5f5; }
.card { background:#fff; padding:30px; border-radius:20px; display:inline-block; box-shadow:0 5px 15px rgba(0,0,0,0.2);}
button { padding:15px 30px; background:#28a745; color:#fff; border:none; border-radius:12px; cursor:pointer; font-size:16px;}
button:hover { background:#1e7e34;}
</style>
</head>
<body>
<div class="card">
<h2>${name}</h2>
<button id="dlBtn">Download Now</button>
</div>
<script>
document.getElementById('dlBtn').addEventListener('click', function(){
    // توليد الرابط أثناء الضغط فقط
    const url = '${fileUrl}'
    this.disabled=true
    window.location.href = url
})
</script>
</body>
</html>
`
}

// توليد صفحة التحميل المباشر
function generateDirectPage(name, fileUrl){
    return `
<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${name}</title>
<meta http-equiv="refresh" content="0;url=${fileUrl}">
</head>
<body>
<p>Downloading ${name}...</p>
</body>
</html>
`
}
</script>
</body>
</html>
